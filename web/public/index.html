<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feuermelder - Fire & Smoke Detector</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <h1>üî• Feuermelder</h1>
                <div class="header-controls">
                    <div class="connection-status" id="connection-status">
                        <span class="status-dot" id="status-dot"></span>
                        <span id="status-text">Verbinde...</span>
                    </div>
                    <button class="mode-toggle" id="history-toggle" title="Historische Daten anzeigen">
                        <span class="icon">üìä</span>
                        <span class="label">History</span>
                    </button>
                    <button class="mode-toggle" id="mode-toggle" title="Wechsel zu Entwicklermodus">
                        <span class="icon">‚öôÔ∏è</span>
                        <span class="label">Dev Mode</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- User Mode (Default) -->
        <div class="view-container" id="user-view">
            <!-- Alert Banner -->
            <div class="alert-banner hidden" id="alert-banner">
                <div class="alert-content">
                    <span class="alert-icon">‚ö†Ô∏è</span>
                    <span class="alert-message" id="alert-message"></span>
                </div>
            </div>

            <!-- Main Dashboard -->
            <div class="dashboard">
                <!-- Fire Detection Card -->
                <div class="status-card critical-card">
                    <div class="card-header">
                        <span class="card-icon">üî•</span>
                        <h2>Feuer-Erkennung</h2>
                    </div>
                    <div class="card-body">
                        <div class="status-indicator" id="fire-status">
                            <div class="status-value">Normal</div>
                            <div class="status-label">Status</div>
                        </div>
                    </div>
                </div>

                <!-- CO Detection Card -->
                <div class="status-card critical-card">
                    <div class="card-header">
                        <span class="card-icon">‚òÅÔ∏è</span>
                        <h2>CO-Sensor</h2>
                    </div>
                    <div class="card-body">
                        <div class="status-indicator" id="co-status">
                            <div class="status-value">Gut</div>
                            <div class="status-label">Luftqualit√§t</div>
                        </div>
                    </div>
                </div>

                <!-- Air Quality Card -->
                <div class="status-card warning-card">
                    <div class="card-header">
                        <span class="card-icon">üí®</span>
                        <h2>Luftqualit√§t</h2>
                    </div>
                    <div class="card-body">
                        <div class="status-indicator" id="air-quality-status">
                            <div class="status-value">Gut</div>
                            <div class="status-label">PM2.5</div>
                        </div>
                    </div>
                </div>

                <!-- Temperature Card -->
                <div class="status-card info-card">
                    <div class="card-header">
                        <span class="card-icon">üå°Ô∏è</span>
                        <h2>Temperatur</h2>
                    </div>
                    <div class="card-body">
                        <div class="temp-display">
                            <div class="temp-main">
                                <span class="temp-value" id="avg-temp">--</span>
                                <span class="temp-unit">¬∞C</span>
                            </div>
                            <div class="temp-status" id="temp-status">Gemessen</div>
                            <div class="temp-sub">
                                <div class="temp-sensor">
                                    <span class="sensor-label">DHT22:</span>
                                    <span id="dht22-temp">--¬∞C</span>
                                </div>
                                <div class="temp-sensor">
                                    <span class="sensor-label">SE95:</span>
                                    <span id="se95-temp">--¬∞C</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Humidity Card -->
                <div class="status-card info-card">
                    <div class="card-header">
                        <span class="card-icon">üíß</span>
                        <h2>Luftfeuchtigkeit</h2>
                    </div>
                    <div class="card-body">
                        <div class="status-indicator" id="humidity-status">
                            <div class="status-value"><span id="humidity-value">--</span>%</div>
                            <div class="status-label" id="humidity-label">--</div>
                        </div>
                    </div>
                </div>

                <!-- Control Card -->
                <div class="status-card control-card">
                    <div class="card-header">
                        <span class="card-icon">üéõÔ∏è</span>
                        <h2>Steuerung</h2>
                    </div>
                    <div class="card-body">
                        <div class="control-item">
                            <label class="control-label">
                                <span>Status LED</span>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="led-toggle" checked>
                                    <span class="slider"></span>
                                </div>
                            </label>
                        </div>
                        <div class="last-update">
                            Letzte Aktualisierung: <span id="last-update-user">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dev Mode -->
        <div class="view-container hidden" id="dev-view">
            <!-- Sensor Grid -->
            <div class="sensor-grid">
                <!-- MQ-7 CO Sensor -->
                <div class="sensor-card">
                    <div class="sensor-header">
                        <h3>MQ-7 CO Sensor</h3>
                        <label class="toggle-switch small">
                            <input type="checkbox" checked data-sensor="mq7">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="sensor-data">
                        <div class="data-row">
                            <span class="label">CO Level:</span>
                            <span class="value badge" id="co-level">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Raw:</span>
                            <span class="value" id="co-raw">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Voltage:</span>
                            <span class="value" id="co-voltage">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Timestamp:</span>
                            <span class="value timestamp" id="co-timestamp">--</span>
                        </div>
                    </div>
                </div>

                <!-- Flame Sensor -->
                <div class="sensor-card">
                    <div class="sensor-header">
                        <h3>IR Flame Sensor</h3>
                        <label class="toggle-switch small">
                            <input type="checkbox" checked data-sensor="flame">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="sensor-data">
                        <div class="data-row">
                            <span class="label">Status:</span>
                            <span class="value badge" id="flame-status-dev">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Raw:</span>
                            <span class="value" id="flame-raw">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Voltage:</span>
                            <span class="value" id="flame-voltage">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Timestamp:</span>
                            <span class="value timestamp" id="flame-timestamp">--</span>
                        </div>
                    </div>
                </div>

                <!-- DHT22 -->
                <div class="sensor-card">
                    <div class="sensor-header">
                        <h3>DHT22 (Temp/Humidity)</h3>
                        <label class="toggle-switch small">
                            <input type="checkbox" checked data-sensor="dht">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="sensor-data">
                        <div class="data-row">
                            <span class="label">Temperature:</span>
                            <span class="value" id="dht-temp-dev">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Temp Status:</span>
                            <span class="value badge" id="dht-temp-status">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Humidity:</span>
                            <span class="value" id="dht-humidity">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Humid Status:</span>
                            <span class="value badge" id="dht-humid-status">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Timestamp:</span>
                            <span class="value timestamp" id="dht-timestamp">--</span>
                        </div>
                    </div>
                </div>

                <!-- PM2.5 -->
                <div class="sensor-card">
                    <div class="sensor-header">
                        <h3>PM2.5 Dust Sensor</h3>
                        <label class="toggle-switch small">
                            <input type="checkbox" checked data-sensor="pm25">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="sensor-data">
                        <div class="data-row">
                            <span class="label">Air Quality:</span>
                            <span class="value badge" id="pm25-quality">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Dust Density:</span>
                            <span class="value" id="pm25-dust">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Raw:</span>
                            <span class="value" id="pm25-raw">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Voltage:</span>
                            <span class="value" id="pm25-voltage">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Timestamp:</span>
                            <span class="value timestamp" id="pm25-timestamp">--</span>
                        </div>
                    </div>
                </div>

                <!-- SE95 -->
                <div class="sensor-card">
                    <div class="sensor-header">
                        <h3>SE95 I2C Temperature</h3>
                        <label class="toggle-switch small">
                            <input type="checkbox" checked data-sensor="se95">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="sensor-data">
                        <div class="data-row">
                            <span class="label">Temperature:</span>
                            <span class="value" id="se95-temp-dev">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Status:</span>
                            <span class="value badge" id="se95-status">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Timestamp:</span>
                            <span class="value timestamp" id="se95-timestamp">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="control-panel">
                <h3>Control Panel</h3>

                <div class="control-section">
                    <label>Polling Rate (ms):</label>
                    <div class="input-group">
                        <input type="number" id="polling-rate" value="1000" min="100" max="60000" step="100">
                        <button onclick="updatePollingRate()">Update</button>
                    </div>
                </div>

                <div class="control-section">
                    <label>Buzzer Control:</label>
                    <div class="button-group">
                        <button onclick="triggerBuzzer('test')" class="btn-secondary">Test</button>
                        <button onclick="triggerBuzzer('warning')" class="btn-warning">Warning</button>
                        <button onclick="triggerBuzzer('alarm')" class="btn-danger">Alarm</button>
                    </div>
                </div>

                <div class="control-section">
                    <label>Status LED:</label>
                    <div class="button-group">
                        <button onclick="toggleLED(true)" class="btn-success" id="led-on-btn">ON</button>
                        <button onclick="toggleLED(false)" class="btn-secondary" id="led-off-btn">OFF</button>
                    </div>
                </div>

                <div class="info-section">
                    <div class="info-row">
                        <span>Current Polling Rate:</span>
                        <span id="current-rate">100 ms</span>
                    </div>
                    <div class="info-row">
                        <span>Last Update:</span>
                        <span id="last-update-dev">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Mode -->
        <div class="view-container hidden" id="history-view">
            <div class="history-controls">
                <h3>üìä Historical Data <span id="data-point-info" style="font-size: 0.8em; color: #a0aec0; font-weight: normal;"></span></h3>
                <div class="time-range-selector">
                    <label>Time Range:</label>
                    <select id="time-range">
                        <option value="0.0167">Last 1 Minute</option>
                        <option value="0.0833">Last 5 Minutes</option>
                        <option value="0.1667">Last 10 Minutes</option>
                        <option value="0.25">Last 15 Minutes</option>
                        <option value="0.5">Last 30 Minutes</option>
                        <option value="0.75">Last 45 Minutes</option>
                        <option value="1">Last Hour</option>
                        <option value="6">Last 6 Hours</option>
                        <option value="24" selected>Last 24 Hours</option>
                        <option value="168">Last Week</option>
                    </select>
                    <label style="margin-left: 20px;">Bucket Size:</label>
                    <select id="bucket-size">
                        <option value="auto" selected>Auto</option>
                        <option value="0">No aggregation (Raw)</option>
                        <option value="1">1 minute</option>
                        <option value="5">5 minutes</option>
                        <option value="15">15 minutes</option>
                        <option value="30">30 minutes</option>
                        <option value="60">1 hour</option>
                    </select>
                    <button onclick="loadHistoricalData()" class="btn-primary">Refresh</button>
                </div>
            </div>

            <div class="charts-grid">
                <!-- Temperature Chart -->
                <div class="chart-card">
                    <h4>üå°Ô∏è Temperature (DHT22 & SE95)</h4>
                    <canvas id="temp-chart"></canvas>
                </div>

                <!-- Humidity Chart -->
                <div class="chart-card">
                    <h4>üíß Humidity</h4>
                    <canvas id="humidity-chart"></canvas>
                </div>

                <!-- CO Level Chart -->
                <div class="chart-card">
                    <h4>‚òÅÔ∏è CO Level</h4>
                    <canvas id="co-chart"></canvas>
                </div>

                <!-- Air Quality Chart -->
                <div class="chart-card">
                    <h4>üí® Air Quality (PM2.5)</h4>
                    <canvas id="air-quality-chart"></canvas>
                </div>
            </div>

            <!-- Recent Alerts -->
            <div class="alerts-section">
                <h3>‚ö†Ô∏è Recent Alerts</h3>
                <div id="alerts-list" class="alerts-list">
                    <p class="loading">Loading alerts...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>